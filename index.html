<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Data Aset Suryatokoku</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  font-family:Arial;
  background:#f4f6f9;
  padding:20px;
}

h1{
  text-align:center;
  color:#0a2a66;
}

.container{
  max-width:1000px;
  margin:auto;
}

.topbar{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
}

button{
  background:#0a2a66;
  color:white;
  padding:10px 15px;
  border:none;
  cursor:pointer;
  border-radius:6px;
}

button:hover{
  background:#081f4d;
}

#searchBox{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:6px;
  border:1px solid #ccc;
}

table{
  width:100%;
  border-collapse:collapse;
  background:white;
}

th, td{
  border:1px solid #ddd;
  padding:8px;
}

th{
  background:#0a2a66;
  color:white;
  text-align:center;
}

tr:hover{
  background:#eef2ff;
}

.icon-btn{
  border:none;
  background:none;
  cursor:pointer;
  font-size:16px;
  margin:0 4px;
}

.icon-btn.edit{ color:#0a2a66; }
.icon-btn.delete{ color:#c0392b; }
.icon-btn.view{ color:#16a085; }

/* MODAL */
.modal{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.25);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal-box{
  background:white;
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:420px;
}

.modal-box input{
  width:100%;
  padding:10px;
  margin-bottom:10px;
}

.modal-box h3{
  margin-top:0;
}

.detail-row{
  margin-bottom:6px;
}

.detail-label{
  font-weight:bold;
  color:#0a2a66;
}

.edit-box{
  max-width:480px;
  width:95%;
}

.edit-box h2{
  text-align:center;
  color:#0a2a66;
  margin-bottom:15px;
}

.edit-box label{
  font-weight:600;
  font-size:14px;
  color:#0a2a66;
}

.edit-box input,
.edit-box select{
  width:100%;
  padding:12px;
  margin-top:5px;
  margin-bottom:14px;
  border-radius:10px;
  border:1px solid #ddd;
  font-size:15px;
}

.edit-box button{
  width:100%;
  padding:14px;
  border-radius:10px;
  font-weight:600;
}

</style>
</head>

<body>

<div class="container">

<h1>DATA ASET SURYATOKOKU</h1>

<div class="topbar">
  <div></div>
  <button onclick="window.location.href='tambah.html'">
    âž• Tambah Aset
  </button>
</div>

<input type="text" id="searchBox" placeholder="ðŸ” Cari aset...">

<table id="asetTable">
  <thead></thead>
  <tbody></tbody>
</table>

</div>

<!-- MODAL EDIT -->
<div id="modal" class="modal">
  <div class="modal-box edit-box">

    <h2>Edit Aset</h2>

    <label>Nama Barang</label>
    <input id="editNama">

    <label>Kategori</label>
    <select id="editKategori">
      <option>Laptop</option>
      <option>Handphone</option>
      <option>Tablet</option>
    </select>

    <label>Merk & Model</label>
    <input id="editMerk">

    <label>Serial / IMEI</label>
    <input id="editSerial">

    <label>Spesifikasi</label>
    <input id="editSpek">

    <label>Status</label>
    <select id="editStatus">
      <option>Aktif</option>
      <option>Dipinjam</option>
      <option>Cadangan</option>
      <option>Perbaikan</option>
      <option>Rusak</option>
    </select>

    <label>Nama Pengguna / PIC</label>
    <input id="editPIC">

    <label>Lokasi</label>
    <input id="editLokasi">

    <label>Keterangan</label>
    <input id="editKet">

    <button onclick="saveEdit()">Simpan Perubahan</button>

  </div>
</div>


<!-- MODAL DETAIL -->
<div id="detailModal" class="modal">
  <div class="modal-box">
    <h3 style="color:#0a2a66;text-align:center;">Detail Aset</h3>
    <div id="detailContent" style="line-height:1.6;font-size:14px;"></div>
    <button onclick="closeDetail()">Tutup</button>
  </div>
</div>


<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw2LrYiqBzd4HpGb7EfikPg4vjRCfExfZFGqmjLi25398sqicLS31aTX_8Oe84b1j7W/exec";
const ADMIN_PASSWORD = "admin123"; // ganti password

let dataGlobal=[];
let lastDeleted=null;
let editRowIndex=null;

function loadData(){
fetch(API_URL)
.then(res => res.json())
.then(data => {
  dataGlobal=data;
  renderTable(data);
});
}

function renderTable(data){
  const head = document.querySelector("#asetTable thead");
  const body = document.querySelector("#asetTable tbody");
  body.innerHTML="";

  let headers = Object.keys(data[0]).filter(h=>h!="rowIndex");

  head.innerHTML = "<tr>" +
    headers.map(h => `<th>${h}</th>`).join("") +
    "<th>Action</th></tr>";

  data.forEach(row => {
    let tr="<tr>";

    headers.forEach(h => tr+=`<td>${row[h] ?? ""}</td>`);

    tr+=`
    <td style="text-align:center">
      <button class="icon-btn view" onclick='showDetail(${JSON.stringify(row)})'><i class="fa fa-eye"></i></button>
      <button class="icon-btn edit" onclick='openEdit(${JSON.stringify(row)})'><i class="fa fa-pen"></i></button>
      <button class="icon-btn delete" onclick='deleteData(${JSON.stringify(row)})'><i class="fa fa-trash"></i></button>
    </td>`;

    tr+="</tr>";
    body.innerHTML+=tr;
  });
}

// SEARCH
document.getElementById("searchBox").addEventListener("input", e=>{
  const key=e.target.value.toLowerCase();
  const filtered=dataGlobal.filter(r =>
    Object.values(r).join(" ").toLowerCase().includes(key)
  );
  renderTable(filtered);
});

// DETAIL POPUP
function showDetail(row){
  const content = `
    <div class="detail-row"><span class="detail-label">Nama:</span> ${row["Nama Barang"]}</div>
    <div class="detail-row"><span class="detail-label">Kategori:</span> ${row["Kategori"]}</div>
    <div class="detail-row"><span class="detail-label">Merk & Model:</span> ${row["Merk & Model"]}</div>
    <div class="detail-row"><span class="detail-label">Serial / IMEI:</span> ${row["Serial Number / IMEI"]}</div>
    <div class="detail-row"><span class="detail-label">Spesifikasi:</span> ${row["Spesifikasi"]}</div>
    <div class="detail-row"><span class="detail-label">Status:</span> ${row["Status"]}</div>
    <div class="detail-row"><span class="detail-label">PIC:</span> ${row["Nama Pengguna / PIC"]}</div>
    <div class="detail-row"><span class="detail-label">Lokasi:</span> ${row["Lokasi"]}</div>
    <div class="detail-row"><span class="detail-label">Keterangan:</span> ${row["Keterangan"]}</div>
  `;

  document.getElementById("detailContent").innerHTML = content;
  document.getElementById("detailModal").style.display = "flex";
}

function closeDetail(){
  document.getElementById("detailModal").style.display = "none";
}


// ADMIN CHECK
function checkAdmin(){
  const pass=prompt("Masukkan password admin:");
  return pass===ADMIN_PASSWORD;
}

// OPEN EDIT
function openEdit(row){
  if(!checkAdmin()) return;

  editRowIndex = row.rowIndex;

  editNama.value = row["Nama Barang"] || "";
  editKategori.value = row["Kategori"] || "Laptop";
  editMerk.value = row["Merk & Model"] || "";
  editSerial.value = row["Serial Number / IMEI"] || "";
  editSpek.value = row["Spesifikasi"] || "";
  editStatus.value = row["Status"] || "Aktif";
  editPIC.value = row["Nama Pengguna / PIC"] || "";
  editLokasi.value = row["Lokasi"] || "";
  editKet.value = row["Keterangan"] || "";

  document.getElementById("modal").style.display = "flex";
}


// SAVE EDIT
function saveEdit(){

  const updated = {
    rowIndex: editRowIndex,
    No: "",
    NamaBarang: editNama.value,
    Kategori: editKategori.value,
    MerkModel: editMerk.value,
    Serial: editSerial.value,
    Spesifikasi: editSpek.value,
    Status: editStatus.value,
    PIC: editPIC.value,
    Lokasi: editLokasi.value,
    Keterangan: editKet.value
  };

  fetch(API_URL,{
    method:"PUT",
    body: JSON.stringify(updated)
  })
  .then(()=>{
    document.getElementById("modal").style.display = "none";
    loadData();
  });
}


// DELETE + UNDO
function deleteData(row){
  if(!checkAdmin()) return;
  if(!confirm("Hapus aset ini?")) return;

  lastDeleted=row;

  fetch(API_URL,{
    method:"DELETE",
    body: JSON.stringify({rowIndex:row.rowIndex})
  })
  .then(()=>{
    if(confirm("Aset dihapus. Undo?")){
      undoDelete();
    }else{
      loadData();
    }
  });
}

function undoDelete(){
  if(!lastDeleted) return;

  fetch(API_URL,{
    method:"POST",
    body: JSON.stringify({
      NamaBarang:lastDeleted["Nama Barang"],
      Kategori:lastDeleted["Kategori"],
      MerkModel:lastDeleted["Merk & Model"],
      Serial:lastDeleted["Serial Number / IMEI"],
      Spesifikasi:lastDeleted["Spesifikasi"],
      Status:lastDeleted["Status"],
      PIC:lastDeleted["Nama Pengguna / PIC"],
      Lokasi:lastDeleted["Lokasi"],
      Keterangan:lastDeleted["Keterangan"]
    })
  }).then(loadData);
}

loadData();
</script>

</body>
</html>
