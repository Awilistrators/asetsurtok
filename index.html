<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Data Aset Suryatokoku</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  font-family:Arial;
  background:#f4f6f9;
  padding:20px;
}

h1{
  text-align:center;
  color:#0a2a66;
}

.container{
  max-width:1000px;
  margin:auto;
}

.topbar{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
}

button{
  background:#0a2a66;
  color:white;
  padding:10px 15px;
  border:none;
  cursor:pointer;
  border-radius:6px;
}

button:hover{
  background:#081f4d;
}

#searchBox{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:6px;
  border:1px solid #ccc;
}

table{
  width:100%;
  border-collapse:collapse;
  background:white;
}

th, td{
  border:1px solid #ddd;
  padding:8px;
}

th{
  background:#0a2a66;
  color:white;
  text-align:center;
}

tr:hover{
  background:#eef2ff;
}

.icon-btn{
  border:none;
  background:none;
  cursor:pointer;
  font-size:16px;
  margin:0 4px;
}

.icon-btn.edit{ color:#0a2a66; }
.icon-btn.delete{ color:#c0392b; }
.icon-btn.view{ color:#16a085; }

/* MODAL */
.modal{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.25);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal-box{
  background:white;
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:420px;
}

.modal-box input{
  width:100%;
  padding:10px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<div class="container">

<h1>DATA ASET SURYATOKOKU</h1>

<div class="topbar">
  <div></div>
  <button onclick="window.location.href='tambah.html'">
    âž• Tambah Aset
  </button>
</div>

<input type="text" id="searchBox" placeholder="ðŸ” Cari aset...">

<table id="asetTable">
  <thead></thead>
  <tbody></tbody>
</table>

</div>

<!-- MODAL EDIT -->
<div id="modal" class="modal">
  <div class="modal-box">
    <h3>Edit Aset</h3>

    <input id="editNama" placeholder="Nama Barang">
    <input id="editMerk" placeholder="Merk & Model">
    <input id="editSerial" placeholder="Serial / IMEI">
    <input id="editSpek" placeholder="Spesifikasi">
    <input id="editStatus" placeholder="Status">
    <input id="editPIC" placeholder="PIC">
    <input id="editLokasi" placeholder="Lokasi">
    <input id="editKet" placeholder="Keterangan">

    <button onclick="saveEdit()">Simpan Perubahan</button>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw2LrYiqBzd4HpGb7EfikPg4vjRCfExfZFGqmjLi25398sqicLS31aTX_8Oe84b1j7W/exec";
const ADMIN_PASSWORD = "admin123"; // ganti password

let dataGlobal=[];
let lastDeleted=null;
let editRowIndex=null;

function loadData(){
fetch(API_URL)
.then(res => res.json())
.then(data => {
  dataGlobal=data;
  renderTable(data);
});
}

function renderTable(data){
  const head = document.querySelector("#asetTable thead");
  const body = document.querySelector("#asetTable tbody");
  body.innerHTML="";

  let headers = Object.keys(data[0]).filter(h=>h!="rowIndex");

  head.innerHTML = "<tr>" +
    headers.map(h => `<th>${h}</th>`).join("") +
    "<th>Action</th></tr>";

  data.forEach(row => {
    let tr="<tr>";

    headers.forEach(h => tr+=`<td>${row[h] ?? ""}</td>`);

    tr+=`
    <td style="text-align:center">
      <button class="icon-btn view" onclick='showDetail(${JSON.stringify(row)})'><i class="fa fa-eye"></i></button>
      <button class="icon-btn edit" onclick='openEdit(${JSON.stringify(row)})'><i class="fa fa-pen"></i></button>
      <button class="icon-btn delete" onclick='deleteData(${JSON.stringify(row)})'><i class="fa fa-trash"></i></button>
    </td>`;

    tr+="</tr>";
    body.innerHTML+=tr;
  });
}

// SEARCH
document.getElementById("searchBox").addEventListener("input", e=>{
  const key=e.target.value.toLowerCase();
  const filtered=dataGlobal.filter(r =>
    Object.values(r).join(" ").toLowerCase().includes(key)
  );
  renderTable(filtered);
});

// DETAIL POPUP
function showDetail(row){
  alert(
`DETAIL ASET

Nama: ${row["Nama Barang"]}
Kategori: ${row["Kategori"]}
Merk: ${row["Merk & Model"]}
Serial: ${row["Serial Number / IMEI"]}
PIC: ${row["Nama Pengguna / PIC"]}
Lokasi: ${row["Lokasi"]}
Status: ${row["Status"]}
Keterangan: ${row["Keterangan"]}`
  );
}

// ADMIN CHECK
function checkAdmin(){
  const pass=prompt("Masukkan password admin:");
  return pass===ADMIN_PASSWORD;
}

// OPEN EDIT
function openEdit(row){
  if(!checkAdmin()) return;

  editRowIndex=row.rowIndex;

  editNama.value=row["Nama Barang"];
  editMerk.value=row["Merk & Model"];
  editSerial.value=row["Serial Number / IMEI"];
  editSpek.value=row["Spesifikasi"];
  editStatus.value=row["Status"];
  editPIC.value=row["Nama Pengguna / PIC"];
  editLokasi.value=row["Lokasi"];
  editKet.value=row["Keterangan"];

  modal.style.display="flex";
}

// SAVE EDIT
function saveEdit(){
  const updated={
    rowIndex:editRowIndex,
    No:"",
    NamaBarang:editNama.value,
    Kategori:"",
    MerkModel:editMerk.value,
    Serial:editSerial.value,
    Spesifikasi:editSpek.value,
    Status:editStatus.value,
    PIC:editPIC.value,
    Lokasi:editLokasi.value,
    Keterangan:editKet.value
  };

  fetch(API_URL,{method:"PUT",body:JSON.stringify(updated)})
  .then(()=>{
    modal.style.display="none";
    loadData();
  });
}

// DELETE + UNDO
function deleteData(row){
  if(!checkAdmin()) return;
  if(!confirm("Hapus aset ini?")) return;

  lastDeleted=row;

  fetch(API_URL,{
    method:"DELETE",
    body: JSON.stringify({rowIndex:row.rowIndex})
  })
  .then(()=>{
    if(confirm("Aset dihapus. Undo?")){
      undoDelete();
    }else{
      loadData();
    }
  });
}

function undoDelete(){
  if(!lastDeleted) return;

  fetch(API_URL,{
    method:"POST",
    body: JSON.stringify({
      NamaBarang:lastDeleted["Nama Barang"],
      Kategori:lastDeleted["Kategori"],
      MerkModel:lastDeleted["Merk & Model"],
      Serial:lastDeleted["Serial Number / IMEI"],
      Spesifikasi:lastDeleted["Spesifikasi"],
      Status:lastDeleted["Status"],
      PIC:lastDeleted["Nama Pengguna / PIC"],
      Lokasi:lastDeleted["Lokasi"],
      Keterangan:lastDeleted["Keterangan"]
    })
  }).then(loadData);
}

loadData();
</script>

</body>
</html>
